---
- name: Adding Apt Keys
  apt_key:
    id: 7BF2812E8A6E88E0
    url: "http://download.proxmox.com/debian/proxmox-ve-release-6.x.gpg"

- name: Setup sources
  template:
    src: "{{ item }}.list.j2"
    dest: "/etc/apt/sources.list.d/{{ item }}.list"
    mode: "0660"
    owner: root
    group: root
  with_items:
    - pve-community
    - pve-enterprise

- name: Update apt cache
  apt:
    update_cache: yes

# As per https://pve.proxmox.com/wiki/Install_Proxmox_VE_on_Debian_Buster#Install_Proxmox_VE_packages
# Be aware, you must set the IP in hosts as per https://pve.proxmox.com/wiki/Install_Proxmox_VE_on_Debian_Buster#Install_a_standard_Debian_Buster_.28amd64.29
- name: Install proxmox
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - proxmox-ve
    - postfix
    - open-iscsi
  when: proxmox_install

